<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContainerListenerBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">psi-probe-core</a> &gt; <a href="index.source.html" class="el_package">psiprobe.beans</a> &gt; <span class="el_source">ContainerListenerBean.java</span></div><h1>ContainerListenerBean.java</h1><pre class="source lang-java linenums">/**
 * Licensed under the GPL License. You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 *
 * THIS PACKAGE IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE.
 */
package psiprobe.beans;

import com.maxmind.db.CHMCache;
import com.maxmind.geoip2.DatabaseReader;
import com.maxmind.geoip2.exception.AddressNotFoundException;
import com.maxmind.geoip2.model.CountryResponse;
import com.maxmind.geoip2.record.Country;
import java.io.File;
import java.net.InetAddress;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Set;
import javax.inject.Inject;
import javax.management.InstanceNotFoundException;
import javax.management.MBeanServer;
import javax.management.MBeanServerNotification;
import javax.management.Notification;
import javax.management.NotificationListener;
import javax.management.ObjectInstance;
import javax.management.ObjectName;
import javax.management.RuntimeOperationsException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import psiprobe.model.Connector;
import psiprobe.model.RequestProcessor;
import psiprobe.model.ThreadPool;
import psiprobe.model.jmx.ThreadPoolObjectName;
import psiprobe.tools.JmxTools;

/**
 * This class interfaces Tomcat JMX functionality to read connection status. The class essentially
 * provides and maintains the list of connection ThreadPools.
 */
<span class="fc" id="L47">public class ContainerListenerBean implements NotificationListener {</span>

  /** The Constant logger. */
<span class="fc" id="L50">  private static final Logger logger = LoggerFactory.getLogger(ContainerListenerBean.class);</span>

  /** The allowed operation. */
<span class="fc" id="L53">  private Set&lt;String&gt; allowedOperation =</span>
<span class="fc" id="L54">      new HashSet&lt;&gt;(Arrays.asList(&quot;start&quot;, &quot;stop&quot;, &quot;pause&quot;, &quot;resume&quot;));</span>

  /** The pool names. */
  private List&lt;ThreadPoolObjectName&gt; poolNames;

  /** The executor names. */
  private List&lt;ObjectName&gt; executorNames;

  /** Used to obtain required {@link MBeanServer} instance. */
  @Inject
  private ContainerWrapperBean containerWrapper;

  /**
   * Gets the container wrapper.
   *
   * @return the container wrapper
   */
  public ContainerWrapperBean getContainerWrapper() {
<span class="fc" id="L72">    return containerWrapper;</span>
  }

  /**
   * Sets the container wrapper.
   *
   * @param containerWrapper the new container wrapper
   */
  public void setContainerWrapper(ContainerWrapperBean containerWrapper) {
<span class="fc" id="L81">    this.containerWrapper = containerWrapper;</span>
<span class="fc" id="L82">  }</span>

  /**
   * Checks if is initialized.
   *
   * @return true, if is initialized
   */
  private boolean isInitialized() {
<span class="nc bnc" id="L90" title="All 4 branches missed.">    return poolNames != null &amp;&amp; !poolNames.isEmpty();</span>
  }

  /**
   * Finds ThreadPoolObjectName by its string name.
   * 
   * @param name - pool name
   * @return null if the input name is null or ThreadPoolObjectName is not found
   */
  private ThreadPoolObjectName findPool(String name) {
<span class="nc bnc" id="L100" title="All 4 branches missed.">    if (name != null &amp;&amp; isInitialized()) {</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">      for (ThreadPoolObjectName threadPoolObjectName : poolNames) {</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (name.equals(threadPoolObjectName.getThreadPoolName().getKeyProperty(&quot;name&quot;))) {</span>
<span class="nc" id="L103">          return threadPoolObjectName;</span>
        }
<span class="nc" id="L105">      }</span>
    }
<span class="nc" id="L107">    return null;</span>
  }

  /**
   * Handles creation and deletion of new &quot;worker&quot; threads.
   *
   * @param notification the notification
   * @param object the object
   */
  @Override
  public synchronized void handleNotification(Notification notification, Object object) {
<span class="nc bnc" id="L118" title="All 2 branches missed.">    if (notification instanceof MBeanServerNotification</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">        &amp;&amp; MBeanServerNotification.REGISTRATION_NOTIFICATION.equals(notification.getType())</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">        || MBeanServerNotification.UNREGISTRATION_NOTIFICATION.equals(notification.getType())) {</span>

<span class="nc" id="L122">      ObjectName objectName = ((MBeanServerNotification) notification).getMBeanName();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">      if (&quot;RequestProcessor&quot;.equals(objectName.getKeyProperty(&quot;type&quot;))) {</span>
<span class="nc" id="L124">        ThreadPoolObjectName threadPoolObjectName = findPool(objectName.getKeyProperty(&quot;worker&quot;));</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (threadPoolObjectName != null) {</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">          if (MBeanServerNotification.REGISTRATION_NOTIFICATION.equals(notification.getType())) {</span>
<span class="nc" id="L127">            threadPoolObjectName.getRequestProcessorNames().add(objectName);</span>
          } else {
<span class="nc" id="L129">            threadPoolObjectName.getRequestProcessorNames().remove(objectName);</span>
          }
        }
      }
    }
<span class="nc" id="L134">  }</span>

  /**
   * Load ObjectNames for the relevant MBeans so they can be queried at a later stage without
   * searching MBean server over and over again.
   *
   * @throws Exception - this method does not handle any of the exceptions that may be thrown when
   *         querying MBean server.
   */
  private synchronized void initialize() throws Exception {

<span class="nc" id="L145">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>
<span class="nc" id="L146">    String serverName = getContainerWrapper().getTomcatContainer().getName();</span>
<span class="nc" id="L147">    Set&lt;ObjectInstance&gt; threadPools =</span>
<span class="nc" id="L148">        server.queryMBeans(new ObjectName(serverName + &quot;:type=ThreadPool,name=\&quot;*\&quot;&quot;), null);  </span>
<span class="nc" id="L149">    poolNames = new ArrayList&lt;&gt;(threadPools.size());</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">    for (ObjectInstance threadPool : threadPools) {</span>

<span class="nc" id="L152">      ThreadPoolObjectName threadPoolObjectName = new ThreadPoolObjectName();</span>
<span class="nc" id="L153">      ObjectName threadPoolName = threadPool.getObjectName();</span>

<span class="nc" id="L155">      String name = threadPoolName.getKeyProperty(&quot;name&quot;);</span>

<span class="nc" id="L157">      threadPoolObjectName.setThreadPoolName(threadPoolName);</span>
<span class="nc" id="L158">      ObjectName grpName = server</span>
<span class="nc" id="L159">          .getObjectInstance(new ObjectName(</span>
<span class="nc" id="L160">              threadPoolName.getDomain() + &quot;:type=GlobalRequestProcessor,name=&quot; + name))</span>
<span class="nc" id="L161">          .getObjectName();</span>
<span class="nc" id="L162">      threadPoolObjectName.setGlobalRequestProcessorName(grpName);</span>

      /*
       * unfortunately exact workers could not be found at the time of testing so we filter out the
       * relevant workers within the loop
       */
<span class="nc" id="L168">      Set&lt;ObjectInstance&gt; workers = server.queryMBeans(</span>
<span class="nc" id="L169">          new ObjectName(threadPoolName.getDomain() + &quot;:type=RequestProcessor,*&quot;), null);</span>

<span class="nc bnc" id="L171" title="All 2 branches missed.">      for (ObjectInstance worker : workers) {</span>
<span class="nc" id="L172">        ObjectName wrkName = worker.getObjectName();</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (name.equals(wrkName.getKeyProperty(&quot;worker&quot;))) {</span>
<span class="nc" id="L174">          threadPoolObjectName.getRequestProcessorNames().add(wrkName);</span>
        }
<span class="nc" id="L176">      }</span>

<span class="nc" id="L178">      poolNames.add(threadPoolObjectName);</span>
<span class="nc" id="L179">    }</span>

<span class="nc" id="L181">    Set&lt;ObjectInstance&gt; executors =</span>
<span class="nc" id="L182">        server.queryMBeans(new ObjectName(serverName + &quot;:type=Executor,*&quot;), null);</span>
<span class="nc" id="L183">    executorNames = new ArrayList&lt;&gt;(executors.size());</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">    for (ObjectInstance executor : executors) {</span>
<span class="nc" id="L185">      ObjectName executorName = executor.getObjectName();</span>
<span class="nc" id="L186">      executorNames.add(executorName);</span>
<span class="nc" id="L187">    }</span>

    // Register with MBean server
<span class="nc" id="L190">    server.addNotificationListener(new ObjectName(&quot;JMImplementation:type=MBeanServerDelegate&quot;),</span>
        this, null, null);

<span class="nc" id="L193">  }</span>

  /**
   * Gets the thread pools.
   *
   * @return the thread pools
   * @throws Exception the exception
   */
  public synchronized List&lt;ThreadPool&gt; getThreadPools() throws Exception {
<span class="nc bnc" id="L202" title="All 2 branches missed.">    if (!isInitialized()) {</span>
<span class="nc" id="L203">      initialize();</span>
    }

<span class="nc" id="L206">    List&lt;ThreadPool&gt; threadPools = new ArrayList&lt;&gt;(poolNames.size());</span>

<span class="nc" id="L208">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>

<span class="nc bnc" id="L210" title="All 2 branches missed.">    for (ObjectName executorName : executorNames) {</span>
<span class="nc" id="L211">      ThreadPool threadPool = new ThreadPool();</span>
<span class="nc" id="L212">      threadPool.setName(executorName.getKeyProperty(&quot;name&quot;));</span>
<span class="nc" id="L213">      threadPool.setMaxThreads(JmxTools.getIntAttr(server, executorName, &quot;maxThreads&quot;));</span>
<span class="nc" id="L214">      threadPool.setMaxSpareThreads(JmxTools.getIntAttr(server, executorName, &quot;largestPoolSize&quot;));</span>
<span class="nc" id="L215">      threadPool.setMinSpareThreads(JmxTools.getIntAttr(server, executorName, &quot;minSpareThreads&quot;));</span>
<span class="nc" id="L216">      threadPool.setCurrentThreadsBusy(JmxTools.getIntAttr(server, executorName, &quot;activeCount&quot;));</span>
<span class="nc" id="L217">      threadPool.setCurrentThreadCount(JmxTools.getIntAttr(server, executorName, &quot;poolSize&quot;));</span>
<span class="nc" id="L218">      threadPools.add(threadPool);</span>
<span class="nc" id="L219">    }</span>

<span class="nc bnc" id="L221" title="All 2 branches missed.">    for (ThreadPoolObjectName threadPoolObjectName : poolNames) {</span>
      try {
<span class="nc" id="L223">        ObjectName poolName = threadPoolObjectName.getThreadPoolName();</span>

<span class="nc" id="L225">        ThreadPool threadPool = new ThreadPool();</span>
<span class="nc" id="L226">        threadPool.setName(poolName.getKeyProperty(&quot;name&quot;));</span>
<span class="nc" id="L227">        threadPool.setMaxThreads(JmxTools.getIntAttr(server, poolName, &quot;maxThreads&quot;));</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (JmxTools.hasAttribute(server, poolName, &quot;maxSpareThreads&quot;)) {</span>
<span class="nc" id="L230">          threadPool.setMaxSpareThreads(JmxTools.getIntAttr(server, poolName, &quot;maxSpareThreads&quot;));</span>
<span class="nc" id="L231">          threadPool.setMinSpareThreads(JmxTools.getIntAttr(server, poolName, &quot;minSpareThreads&quot;));</span>
        }

<span class="nc" id="L234">        threadPool</span>
<span class="nc" id="L235">            .setCurrentThreadsBusy(JmxTools.getIntAttr(server, poolName, &quot;currentThreadsBusy&quot;));</span>
<span class="nc" id="L236">        threadPool</span>
<span class="nc" id="L237">            .setCurrentThreadCount(JmxTools.getIntAttr(server, poolName, &quot;currentThreadCount&quot;));</span>

        /*
         * Tomcat will return -1 for maxThreads if the connector uses an executor for its threads.
         * In this case, don't add its ThreadPool to the results.
         */
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (threadPool.getMaxThreads() &gt; -1) {</span>
<span class="nc" id="L244">          threadPools.add(threadPool);</span>
        }
<span class="nc" id="L246">      } catch (InstanceNotFoundException e) {</span>
<span class="nc" id="L247">        logger.error(&quot;Failed to query entire thread pool {}&quot;, threadPoolObjectName);</span>
<span class="nc" id="L248">        logger.debug(&quot;&quot;, e);</span>
<span class="nc" id="L249">      }</span>
<span class="nc" id="L250">    }</span>
<span class="nc" id="L251">    return threadPools;</span>
  }

  /**
   * Toggle connector status.
   *
   * @param operation the operation
   * @param port the port
   * @throws Exception the exception
   */
  public synchronized void toggleConnectorStatus(String operation, String port) throws Exception {

<span class="nc bnc" id="L263" title="All 2 branches missed.">    if (!allowedOperation.contains(operation)) {</span>
<span class="nc" id="L264">      logger.error(&quot;operation {} not supported&quot;, operation);</span>
<span class="nc" id="L265">      throw new IllegalArgumentException(&quot;Not support operation&quot;);</span>
    }

<span class="nc" id="L268">    ObjectName objectName = new ObjectName(&quot;Catalina:type=Connector,port=&quot; + port);</span>

<span class="nc" id="L270">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>

<span class="nc" id="L272">    JmxTools.invoke(server, objectName, operation, null, null);</span>

<span class="nc" id="L274">    logger.info(&quot;operation {} on Connector {} invoked success&quot;, operation, objectName);</span>
<span class="nc" id="L275">  }</span>

  /**
   * Gets the connectors.
   *
   * @param includeRequestProcessors the include request processors
   * @return the connectors
   * @throws Exception the exception
   */
  public synchronized List&lt;Connector&gt; getConnectors(boolean includeRequestProcessors)
      throws Exception {

<span class="nc" id="L287">    boolean workerThreadNameSupported = true;</span>

<span class="nc bnc" id="L289" title="All 2 branches missed.">    if (!isInitialized()) {</span>
<span class="nc" id="L290">      initialize();</span>
    }

<span class="nc" id="L293">    List&lt;Connector&gt; connectors = new ArrayList&lt;&gt;(poolNames.size());</span>

<span class="nc" id="L295">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>

<span class="nc bnc" id="L297" title="All 2 branches missed.">    for (ThreadPoolObjectName threadPoolObjectName : poolNames) {</span>
      try {
<span class="nc" id="L299">        ObjectName poolName = threadPoolObjectName.getThreadPoolName();</span>

<span class="nc" id="L301">        Connector connector = new Connector();</span>

<span class="nc" id="L303">        String name = poolName.getKeyProperty(&quot;name&quot;);</span>

<span class="nc" id="L305">        connector.setProtocolHandler(poolName.getKeyProperty(&quot;name&quot;));</span>

<span class="nc bnc" id="L307" title="All 4 branches missed.">        if (name.startsWith(&quot;\&quot;&quot;) &amp;&amp; name.endsWith(&quot;\&quot;&quot;)) {</span>
<span class="nc" id="L308">          name = name.substring(1, name.length() - 1);</span>
        }

<span class="nc" id="L311">        String[] arr = name.split(&quot;-&quot;);</span>
<span class="nc" id="L312">        String port = &quot;-1&quot;;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (arr.length == 3) {</span>
<span class="nc" id="L314">          port = arr[2];</span>
        }

<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (!&quot;-1&quot;.equals(port)) {</span>
<span class="nc" id="L318">          String str = &quot;Catalina:type=Connector,port=&quot; + port;</span>

<span class="nc" id="L320">          ObjectName objectName = new ObjectName(str);</span>

          // add some useful information for connector list
<span class="nc" id="L323">          connector.setStatus(JmxTools.getStringAttr(server, objectName, &quot;stateName&quot;));</span>
<span class="nc" id="L324">          connector.setProtocol(JmxTools.getStringAttr(server, objectName, &quot;protocol&quot;));</span>
<span class="nc" id="L325">          connector.setSecure(</span>
<span class="nc" id="L326">              Boolean.parseBoolean(JmxTools.getStringAttr(server, objectName, &quot;secure&quot;)));</span>
<span class="nc" id="L327">          connector.setPort(JmxTools.getIntAttr(server, objectName, &quot;port&quot;));</span>
<span class="nc" id="L328">          connector.setLocalPort(JmxTools.getIntAttr(server, objectName, &quot;localPort&quot;));</span>
<span class="nc" id="L329">          connector.setSchema(JmxTools.getStringAttr(server, objectName, &quot;schema&quot;));</span>
        }

<span class="nc" id="L332">        ObjectName grpName = threadPoolObjectName.getGlobalRequestProcessorName();</span>

<span class="nc" id="L334">        connector.setMaxTime(JmxTools.getLongAttr(server, grpName, &quot;maxTime&quot;));</span>
<span class="nc" id="L335">        connector.setProcessingTime(JmxTools.getLongAttr(server, grpName, &quot;processingTime&quot;));</span>
<span class="nc" id="L336">        connector.setBytesReceived(JmxTools.getLongAttr(server, grpName, &quot;bytesReceived&quot;));</span>
<span class="nc" id="L337">        connector.setBytesSent(JmxTools.getLongAttr(server, grpName, &quot;bytesSent&quot;));</span>
<span class="nc" id="L338">        connector.setRequestCount(JmxTools.getIntAttr(server, grpName, &quot;requestCount&quot;));</span>
<span class="nc" id="L339">        connector.setErrorCount(JmxTools.getIntAttr(server, grpName, &quot;errorCount&quot;));</span>

<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (includeRequestProcessors) {</span>
<span class="nc" id="L342">          List&lt;ObjectName&gt; wrkNames = threadPoolObjectName.getRequestProcessorNames();</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">          for (ObjectName wrkName : wrkNames) {</span>
            try {
<span class="nc" id="L345">              RequestProcessor rp = new RequestProcessor();</span>
<span class="nc" id="L346">              rp.setName(wrkName.getKeyProperty(&quot;name&quot;));</span>
<span class="nc" id="L347">              rp.setStage(JmxTools.getIntAttr(server, wrkName, &quot;stage&quot;));</span>
<span class="nc" id="L348">              rp.setProcessingTime(JmxTools.getLongAttr(server, wrkName, &quot;requestProcessingTime&quot;));</span>
<span class="nc" id="L349">              rp.setBytesSent(JmxTools.getLongAttr(server, wrkName, &quot;requestBytesSent&quot;));</span>
<span class="nc" id="L350">              rp.setBytesReceived(JmxTools.getLongAttr(server, wrkName, &quot;requestBytesReceived&quot;));</span>
              try {
<span class="nc" id="L352">                rp.setRemoteAddr(JmxTools.getStringAttr(server, wrkName, &quot;remoteAddr&quot;));</span>
<span class="nc" id="L353">              } catch (RuntimeOperationsException ex) {</span>
<span class="nc" id="L354">                logger.trace(&quot;&quot;, ex);</span>
<span class="nc" id="L355">              }</span>

<span class="nc bnc" id="L357" title="All 2 branches missed.">              if (rp.getRemoteAddr() != null) {</span>
                // Show flag as defined in jvm for localhost
<span class="nc bnc" id="L359" title="All 2 branches missed.">                if (InetAddress.getByName(rp.getRemoteAddr()).isLoopbackAddress()) {</span>
<span class="nc" id="L360">                  rp.setRemoteAddrLocale(new Locale(System.getProperty(&quot;user.language&quot;),</span>
<span class="nc" id="L361">                      System.getProperty(&quot;user.country&quot;)));</span>
                } else {
                  // Show flag for non-localhost using geo lite
<span class="nc" id="L364">                  try (DatabaseReader reader = new DatabaseReader.Builder(new File(</span>
<span class="nc" id="L365">                      getClass().getClassLoader().getResource(&quot;GeoLite2-Country.mmdb&quot;).toURI()))</span>
<span class="nc" id="L366">                          .withCache(new CHMCache()).build()) {</span>
<span class="nc" id="L367">                    CountryResponse response =</span>
<span class="nc" id="L368">                        reader.country(InetAddress.getByName(rp.getRemoteAddr()));</span>
<span class="nc" id="L369">                    Country country = response.getCountry();</span>
<span class="nc" id="L370">                    rp.setRemoteAddrLocale(new Locale(&quot;&quot;, country.getIsoCode()));</span>
<span class="nc" id="L371">                  } catch (AddressNotFoundException e) {</span>
<span class="nc" id="L372">                    logger.debug(&quot;Address Not Found: {}&quot;, e.getMessage());</span>
<span class="nc" id="L373">                    logger.trace(&quot;&quot;, e);</span>
<span class="nc" id="L374">                  }</span>
                }
              }

<span class="nc" id="L378">              rp.setVirtualHost(JmxTools.getStringAttr(server, wrkName, &quot;virtualHost&quot;));</span>
<span class="nc" id="L379">              rp.setMethod(JmxTools.getStringAttr(server, wrkName, &quot;method&quot;));</span>
<span class="nc" id="L380">              rp.setCurrentUri(JmxTools.getStringAttr(server, wrkName, &quot;currentUri&quot;));</span>
<span class="nc" id="L381">              rp.setCurrentQueryString(</span>
<span class="nc" id="L382">                  JmxTools.getStringAttr(server, wrkName, &quot;currentQueryString&quot;));</span>
<span class="nc" id="L383">              rp.setProtocol(JmxTools.getStringAttr(server, wrkName, &quot;protocol&quot;));</span>

              // Relies on https://issues.apache.org/bugzilla/show_bug.cgi?id=41128
<span class="nc bnc" id="L386" title="All 2 branches missed.">              if (workerThreadNameSupported</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">                  &amp;&amp; JmxTools.hasAttribute(server, wrkName, &quot;workerThreadName&quot;)) {</span>

<span class="nc" id="L389">                rp.setWorkerThreadName(JmxTools.getStringAttr(server, wrkName, &quot;workerThreadName&quot;));</span>
<span class="nc" id="L390">                rp.setWorkerThreadNameSupported(true);</span>
              } else {
                /*
                 * attribute should consistently either exist or be missing across all the workers
                 * so it does not make sense to check attribute existence if we have found once that
                 * it is not supported
                 */
<span class="nc" id="L397">                rp.setWorkerThreadNameSupported(false);</span>
<span class="nc" id="L398">                workerThreadNameSupported = false;</span>
              }
<span class="nc" id="L400">              connector.addRequestProcessor(rp);</span>
<span class="nc" id="L401">            } catch (InstanceNotFoundException e) {</span>
<span class="nc" id="L402">              logger.info(&quot;Failed to query RequestProcessor {}&quot;, wrkName);</span>
<span class="nc" id="L403">              logger.debug(&quot;&quot;, e);</span>
<span class="nc" id="L404">            }</span>
<span class="nc" id="L405">          }</span>
        }

<span class="nc" id="L408">        connectors.add(connector);</span>
<span class="nc" id="L409">      } catch (InstanceNotFoundException e) {</span>
<span class="nc" id="L410">        logger.error(&quot;Failed to query entire thread pool {}&quot;, threadPoolObjectName);</span>
<span class="nc" id="L411">        logger.debug(&quot;  Stack trace:&quot;, e);</span>
<span class="nc" id="L412">      }</span>
<span class="nc" id="L413">    }</span>
<span class="nc" id="L414">    return connectors;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>